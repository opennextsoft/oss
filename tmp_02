0)RSSデータのページの生成の前提

●sourcelist内に設定されているsource_idに下記のパラメータを決める。
---------------------------------------------------------------------
パラメータ				説明
---------------------------------------------------------------------
コンテンツデータ生成の一時ディレクトリ	tmp_gen_cont_dir
コンテンツデータ生成の実ディレクトリ	ouput_dir
TOPページのファイル名			toplist_page
TOPページのテンプレートファイル		toplist_tmpl
詳細ページのファイル名のフォーマット	detaillist_page
詳細ページのテンプレートファイル		detaillist_tmpl
記事ページのファイル名のフォーマット	article_page
記事ページのテンプレートファイル		article_tmpl
サムネイル非公開ディレクトリ   	thum_priv_dir
サムネイル公開ディレクトリ		thum_pub_dir
TOPページに記事の数			toplist_paging_num
詳細ページ毎に記事の数		detaillist_paging_num
---------------------------------------------------------------------

1)一時RSSデータのページの生成
●一時コンテンツ生成ディレクトリ配下にディレクトリまたはファイルをすべて削除する。
　・ディレクトリまたはファイルの削除に失敗した場合、コンテンツデータ生成異常フラグにONを設定する。

●DBからTOPページのRSSデータを取得する。
　・取得条件は次の通りである。
　　・最新公開日で昇順でソート
　　・最大件数は$conf['toplist_max_num']とする
　・DBの取得に失敗した場合、エラーログを出力する。
　　・コンテンツページ生成異常フラグにONを設定する。

●一時TOPページのコンテンツデータを生成する。
　・TOPページのテンプレートファイルを読み込む。
　　・テンプレートファイルの読み込みに失敗した場合、エラーログを出力する。
　　　・コンテンツデータ生成異常フラグにONを設定する。
　・読み込んだテンプレートの内容にタグを置換する。
　　・置換内容はTOPページの最新コンテンツデータとする
　　・TODOに従い、タグを置換する。
　・置換したデータを一時TOPページに書き込む。
　　・一時TOPページのPATHはコンテンツデータ生成の一時ディレクトリ/TOPページのファイル名とする。
　　・一時TOPページに書き込みに失敗した場合、エラーログを出力する。
　　　・コンテンツデータ生成異常フラグにONを設定する。


●一時詳細ページを生成する。
　・DBに有効なRSSデータを数える。
　　・DBの取得に失敗した場合、エラーログを出力する。
　　　・コンテンツページ生成異常フラグにONを設定する。
　・詳細ページのファイルテンプレートを読み込む。
　　・テンプレートの読み込みに失敗した場合、エラーログを出力する。
　　　・コンテンツページ生成異常フラグにONを設定する。
　　・読み込んだ内容は詳細ページのテンプレートデータと読む。
　・詳細ページの数を計算する。仮詳細ページの数はXとする。
　　・有効なRSSデータの数と詳細ページ毎に記事の最大数によって、詳細ページの数を確定する。
　　・記事ページのファイルパスの「%」をページ番目を置換し、記事ページのファイルパスを作成する。
　・1からXまで一時詳細ページを作成する。
　　・メモリの使用を削減できるように、DBにすべて有効なRSSデータを取得するのではなく、詳細ページの数により、RSSデータを分割し、一時詳細ページを作成する。
　　　・DBにX回取得し、一時詳細ページを作成する。
　　　・DBの取得条件は次の通りである。
　　　　・table.pub_dateは昇順でソートする
　　　　・table.rss_statusは1とする
　　・実装として、次のような詳細ページのコンテンツデータを確定する。
	・詳細ページのY番目を作成する
　　　　・DBに「Y * 詳細ページ毎に記事の数 + 1」から「(Y + 1) 詳細ページ毎に記事の数」までRSSデータを取得する。
　　　　・テンプレートデータのタグをRSSデータに置換する。
　　　　・置換したデータを一時詳細ページに書き込む。
　　　　　・書き込みに失敗した場合、エラーログを出力する。
		・コンテンツページ生成異常フラグにONを設定する。

●一時記事ページを生成する。
　・記事ページのテンプレートファイルを読み込む。
　　・テンプレートファイルの読み込みに失敗した場合、エラーログを出力する。
　　　・コンテンツデータ生成異常フラグにONを設定する。
　・記事ページを作成するコンテンツデータが空ではない場合、記事ページを作成するコンテンツデータからRSSデータを繰り返し、一時記事ページを作成する。
　　・記事ページのファイル名は記事ページのファイルフォーマットの「%s」をtable.rss_idを置換する。
　　・テンプレートデータのタグをRSSデータに置換する。
　　・置換したデータを一時記事ページに書き込む。
　　　・一時記事ページのPATHはコンテンツデータ生成の一時ディレクトリ/記事ページのファイル名とする。
　　　・書き込みに失敗した場合、エラーログを出力する。
　　　　・コンテンツデータ生成異常フラグにONを設定する。

●一時サムネイルを生成する。
・TOPページの最新コンテンツデータに対し、一時サムネイルのリンクを作成する。
　・サムネイルのリンク元はサムネイル公開ディレクトリ/table.thumbnail
　・サムネイルのリンク先は一時コンテンツ生成ディレクトリ/table.thumbnail
・詳細ページの最新コンテンツデータに対し、一時サムネイルのリンクを作成する。
　・サムネイルのリンク元はサムネイル公開ディレクトリ/table.thumbnail
　・サムネイルのリンク先は一時コンテンツ生成ディレクトリ/table.thumbnail
・記事ページを作成するコンテンツデータは空ではない場合、記事ページを作成するコンテンツデータに対し、一時サムネイルのリンクを作成する。
　・サムネイルのリンク元はサムネイル公開ディレクトリ/table.thumbnail
　・サムネイルのリンク先は一時コンテンツ生成ディレクトリ/table.thumbnail

●一時記事ページを公開ディレクトリに反映する。
　・記事ページを削除するコンテンツデータが空ではない場合、記事ページを削除するコンテンツデータに対し、現在の記事ページの削除を繰り返す。
　　・現在の記事ページを削除する。
　　　・現在の記事ページのファイル名は記事ページのファイル名のフォーマットの「%s」をtable.rss_idに置換する。
　　　・現在の記事ページの削除に失敗した場合、エラーログを出力する。
　　　　・コンテンツデータ生成異常フラグにONを設定する。
　　・現在サムネイルファイルを削除する。
　　　・現在サムネイルファイルはサムネイル公開ディレクトリ/table.rss_idである。
　　　・現在サムネイルファイルの削除に失敗した場合、エラーログを出力する。
　　　　・コンテンツデータ生成異常フラグにONを設定する。
　・記事ページを削除するコンテンツデータが空ではない場合、新しい記事ページの削除を繰り返す。。
　　・現在の記事ページジをバックアップディレクトリにバックアップする。
　　　・現在の記事ページのファイル名は記事ページのファイル名のフォーマットの「%s」をtable.rss_idに置換する。
　　　・バックアップファイル名は現在の記事ページのファイル名.{PID}.backupとする
　　　・バックアップに失敗した場合、エラーログを出力する。
　　　　・コンテンツデータ生成異常フラグにONを設定する。
　　・現在のサムネイルファイルをバックアップディレクトリにバックアップする。
　　　・現在のサムネイルファイルはサムネイル公開ディレクトリ/table.rss_idである。
　　　・バックアップに失敗した場合、エラーログを出力する。
　　　　・コンテンツデータ生成異常フラグにONを設定する。
　　・新しい記事ページを現在の記事ページに移動する。
　　　・ファイルの移動に失敗した場合、エラーログを出力する。
　　　　・コンテンツデータ生成異常フラグにONを設定する。
　　・新しいサムネイルファイルを現在サムネイルファイルに移動する。
　　　・ファイルの移動に失敗した場合、エラーログを出力する。
　　　　・コンテンツデータ生成異常フラグにONを設定する。

●一時詳細ページに公開ディレクトリに反映する。
　・現在の詳細ページをすべてバックアップする。
　　・バックアップファイル名は現在の詳細ページのファイル名.{PID}.backupとする。
　　・バックアップに失敗した場合、エラーログを出力する。
　　　・コンテンツデータ生成異常フラグにONを設定する。
　・新しい詳細ページを現在詳細ページを移動する。
　　・現在の詳細ページの数は生新しい詳細ページの数より多い場合、その詳細ページを削除する。
　　・ファイルの移動に失敗した場合、エラーログを出力する。
　　　・コンテンツデータ生成異常フラグにONを設定する。

●一時TOPページを公開ディレクトリに反映する。
　・現在のTOPページをバックアップディレクトリにバックアップする。
　　・バックアップファイル名は現在のTOPページのファイル名.{PID}.backupとする。
　　・バックアップに失敗した場合、エラーログを出力する。
　　　・コンテンツデータ生成異常フラグにONを設定する。
　・新しいTOPページジを現在のTOPページジに移動する
　　・ファイルの移動に失敗した場合、エラーログを出力する。
　　　・コンテンツデータ生成異常フラグにONを設定する。

●DBにRSSデータのステータスを更新する。
　・TOPページの最新コンテンツデータ、詳細ページの最新コンテンツデータに対し、DBの更新を行う。
　　設定項目			設定値		備考
　　table.output_status	1
　　table.updatea_by	右記		1:ツール	2:手動
　　table.updated_at	現在の日時	形式yyyy/mm/dd hh:mm:ss
　・その他RSSはDBに次のように変更する
　　設定項目			設定値		備考
　　table.output_status	0
　　table.updatea_by	右記		1:ツール	2:手動
　　table.updated_at	現在の日時	形式yyyy/mm/dd hh:mm:ss
